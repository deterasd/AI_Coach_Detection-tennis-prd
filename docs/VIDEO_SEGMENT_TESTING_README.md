# å½±ç‰‡è‡ªå‹•åˆ†å‰²æ¸¬è©¦å·¥å…·ä½¿ç”¨èªªæ˜

## ğŸ“ æª”æ¡ˆèªªæ˜

### 1. `video_segment_tester.py` - GUIåœ–å½¢åŒ–ä»‹é¢ç‰ˆæœ¬
åŠŸèƒ½å®Œæ•´çš„åœ–å½¢åŒ–æ¸¬è©¦å·¥å…·ï¼Œæä¾›ï¼š
- æª”æ¡ˆé¸æ“‡ç•Œé¢
- åƒæ•¸èª¿æ•´
- å³æ™‚é€²åº¦é¡¯ç¤º
- çµæœé è¦½åœ–è¡¨
- HTMLå ±å‘ŠåŒ¯å‡º

### 2. `video_segment_test_cli.py` - å‘½ä»¤è¡Œç‰ˆæœ¬
è¼•é‡åŒ–çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé©åˆå¿«é€Ÿæ¸¬è©¦å’Œæ‰¹è™•ç†ã€‚

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### GUIç‰ˆæœ¬ä½¿ç”¨æ­¥é©Ÿï¼š
```bash
python video_segment_tester.py
```

1. **è¼‰å…¥æ¨¡å‹**: é»æ“Š"è¼‰å…¥æ¨¡å‹"æŒ‰éˆ•è¼‰å…¥ `model/tennisball_OD_v1.pt`
2. **é¸æ“‡å½±ç‰‡**: é»æ“Š"ç€è¦½"é¸æ“‡è¦æ¸¬è©¦çš„å½±ç‰‡æª”æ¡ˆ
3. **è¨­å®šè¼¸å‡ºè³‡æ–™å¤¾**: é¸æ“‡è¼¸å‡ºä½ç½®
4. **èª¿æ•´åƒæ•¸**: 
   - ç‰‡æ®µæ™‚é•·: æ¯å€‹åˆ†å‰²ç‰‡æ®µçš„é•·åº¦ï¼ˆå»ºè­°4ç§’ï¼‰
   - åµæ¸¬ä¿¡å¿ƒåº¦: YOLOåµæ¸¬çš„ä¿¡å¿ƒåº¦é–¾å€¼ï¼ˆå»ºè­°0.5ï¼‰
   - æœ€å°é–“éš”: é˜²æ­¢é‡è¤‡åµæ¸¬çš„æœ€å°æ™‚é–“é–“éš”ï¼ˆå»ºè­°2ç§’ï¼‰
   - é è¦½é–‹å§‹æ™‚é–“: ç‰‡æ®µé–‹å§‹æ™‚é–“ç›¸å°æ–¼çƒé€²å…¥æ™‚é–“çš„åç§»ï¼ˆå»ºè­°-0.5ç§’ï¼‰
5. **åˆ†æå½±ç‰‡**: é»æ“Š"åˆ†æå½±ç‰‡"é–‹å§‹åˆ†æ
6. **é è¦½çµæœ**: é»æ“Š"é è¦½çµæœ"æŸ¥çœ‹åµæ¸¬åœ–è¡¨
7. **åŸ·è¡Œåˆ†å‰²**: é»æ“Š"åŸ·è¡Œåˆ†å‰²"ç”¢ç”Ÿåˆ†å‰²ç‰‡æ®µ
8. **åŒ¯å‡ºå ±å‘Š**: é»æ“Š"åŒ¯å‡ºå ±å‘Š"ç”Ÿæˆè©³ç´°å ±å‘Š

### å‘½ä»¤è¡Œç‰ˆæœ¬ä½¿ç”¨ï¼š

**åŸºæœ¬ä½¿ç”¨:**
```bash
python video_segment_test_cli.py your_video.mp4
```

**é€²éšåƒæ•¸è¨­å®š:**
```bash
python video_segment_test_cli.py your_video.mp4 \
    --output segments_output \
    --confidence 0.6 \
    --duration 5 \
    --min-interval 3 \
    --start-offset -0.5
```

**æ¨¡æ“¬æ¨¡å¼ï¼ˆç„¡éœ€YOLOæ¨¡å‹ï¼‰:**
```bash
python video_segment_test_cli.py your_video.mp4 --simulate
```

## âš™ï¸ åƒæ•¸èªªæ˜

| åƒæ•¸ | èªªæ˜ | é è¨­å€¼ | å»ºè­°ç¯„åœ |
|------|------|--------|----------|
| `--confidence` | YOLOåµæ¸¬ä¿¡å¿ƒåº¦é–¾å€¼ | 0.5 | 0.3-0.8 |
| `--duration` | æ¯å€‹ç‰‡æ®µçš„æ™‚é•·(ç§’) | 4.0 | 3.0-6.0 |
| `--min-interval` | é˜²æ­¢é‡è¤‡åµæ¸¬çš„æœ€å°é–“éš”(ç§’) | 2.0 | 1.0-5.0 |
| `--start-offset` | ç‰‡æ®µé–‹å§‹æ™‚é–“åç§»(ç§’) | -0.5 | -1.0-0.0 |
| `--output` | è¼¸å‡ºè³‡æ–™å¤¾è·¯å¾‘ | segments_output | ä»»æ„è·¯å¾‘ |
| `--model` | YOLOæ¨¡å‹è·¯å¾‘ | model/tennisball_OD_v1.pt | ä»»æ„.ptæª” |
| `--simulate` | ä½¿ç”¨æ¨¡æ“¬æ¨¡å¼ | False | True/False |

## ğŸ“Š è¼¸å‡ºçµæœ

### åˆ†å‰²å¾Œçš„æª”æ¡ˆçµæ§‹ï¼š
```
segments_output/
â”œâ”€â”€ your_video_segment_01.mp4  # ç¬¬1å€‹åˆ†å‰²ç‰‡æ®µ
â”œâ”€â”€ your_video_segment_02.mp4  # ç¬¬2å€‹åˆ†å‰²ç‰‡æ®µ
â”œâ”€â”€ your_video_segment_03.mp4  # ç¬¬3å€‹åˆ†å‰²ç‰‡æ®µ
â”œâ”€â”€ analysis_results.json      # åˆ†æçµæœJSON
â”œâ”€â”€ detection_details.csv      # è©³ç´°åµæ¸¬è³‡æ–™CSV
â””â”€â”€ analysis_report.html       # åˆ†æå ±å‘ŠHTML (åƒ…GUIç‰ˆæœ¬)
```

### analysis_results.json çµæ§‹ï¼š
```json
{
  "analysis_info": {
    "input_video": "path/to/input.mp4",
    "analysis_time": "2024-01-18T10:30:00",
    "total_detections": 1500,
    "ball_entries": 3
  },
  "parameters": {
    "confidence_threshold": 0.5,
    "segment_duration": 4.0,
    "min_interval": 2.0,
    "start_offset": -0.5
  },
  "ball_entry_times": [5.2, 12.8, 18.3],
  "segments": [
    {
      "segment_id": 1,
      "entry_time": 5.2,
      "start_time": 4.7,
      "duration": 4.0,
      "output_file": "path/to/segment_01.mp4",
      "file_size_mb": 15.2,
      "success": true
    }
  ]
}
```

## ğŸ§ª æ¸¬è©¦å»ºè­°

### 1. æ¸¬è©¦ä¸åŒé¡å‹çš„å½±ç‰‡ï¼š
- **å®¤å…§å½±ç‰‡**: èƒŒæ™¯è¼ƒç°¡å–®ï¼Œåµæ¸¬é€šå¸¸è¼ƒæº–ç¢º
- **å®¤å¤–å½±ç‰‡**: èƒŒæ™¯è¤‡é›œï¼Œå¯èƒ½éœ€è¦èª¿é«˜ä¿¡å¿ƒåº¦é–¾å€¼
- **ä¸åŒå…‰ç·šæ¢ä»¶**: èª¿æ•´åµæ¸¬åƒæ•¸

### 2. åƒæ•¸èª¿å„ªï¼š
- **åµæ¸¬ç‡å¤ªä½**: é™ä½ `confidence` å€¼ï¼ˆ0.3-0.4ï¼‰
- **èª¤åµæ¸¬å¤ªå¤š**: æé«˜ `confidence` å€¼ï¼ˆ0.6-0.8ï¼‰
- **ç‰‡æ®µé‡ç–Š**: å¢åŠ  `min_interval` å€¼
- **å‹•ä½œè¢«æˆªæ–·**: èª¿æ•´ `start_offset` å’Œ `duration`

### 3. æ¸¬è©¦æµç¨‹ï¼š
1. å…ˆç”¨å°æ®µæ¸¬è©¦å½±ç‰‡é©—è­‰åƒæ•¸
2. ä½¿ç”¨ GUI ç‰ˆæœ¬çš„é è¦½åŠŸèƒ½æª¢æŸ¥åµæ¸¬çµæœ
3. ç¢ºèªåƒæ•¸å¾Œå†è™•ç†å®Œæ•´å½±ç‰‡
4. æª¢æŸ¥åˆ†å‰²çµæœçš„å“è³ª

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œï¼š

**1. æ¨¡å‹è¼‰å…¥å¤±æ•—**
- ç¢ºèª `model/tennisball_OD_v1.pt` æª”æ¡ˆå­˜åœ¨
- æª¢æŸ¥ YOLO å¥—ä»¶æ˜¯å¦æ­£ç¢ºå®‰è£

**2. FFmpeg éŒ¯èª¤**
- ç¢ºèªç³»çµ±å·²å®‰è£ FFmpeg
- æª¢æŸ¥å½±ç‰‡æª”æ¡ˆæ˜¯å¦æå£

**3. æ²’æœ‰åµæ¸¬åˆ°çƒ**
- å˜—è©¦é™ä½ä¿¡å¿ƒåº¦é–¾å€¼
- ä½¿ç”¨æ¨¡æ“¬æ¨¡å¼æ¸¬è©¦åŸºæœ¬åŠŸèƒ½
- æª¢æŸ¥å½±ç‰‡ä¸­æ˜¯å¦ç¢ºå¯¦æœ‰ç¶²çƒ

**4. åˆ†å‰²çµæœä¸ç†æƒ³**
- èª¿æ•´ `start_offset` åƒæ•¸
- ä¿®æ”¹ `duration` åƒæ•¸
- æª¢æŸ¥ `min_interval` è¨­å®š

### é™¤éŒ¯æ¨¡å¼ï¼š
```bash
# ä½¿ç”¨æ¨¡æ“¬æ¨¡å¼æ¸¬è©¦åŸºæœ¬åŠŸèƒ½
python video_segment_test_cli.py your_video.mp4 --simulate

# é™ä½ä¿¡å¿ƒåº¦é–¾å€¼
python video_segment_test_cli.py your_video.mp4 --confidence 0.3

# å¢åŠ åµæ¸¬è©³ç´°åº¦
python video_segment_test_cli.py your_video.mp4 --min-interval 1.0
```

## ğŸ’¡ é€²éšæ‡‰ç”¨

### æ‰¹æ¬¡è™•ç†å¤šå€‹å½±ç‰‡ï¼š
```bash
for video in *.mp4; do
    python video_segment_test_cli.py "$video" --output "segments_$(basename "$video" .mp4)"
done
```

### æ•´åˆåˆ°ç¾æœ‰ç³»çµ±ï¼š
å¯ä»¥å°‡ `detect_ball_entry_points()` å’Œ `segment_video()` å‡½æ•¸åŒ¯å…¥åˆ°ä½ çš„ `main.py` ä¸­ä½¿ç”¨ã€‚

---

## ğŸ“ æ”¯æ´

å¦‚æœé‡åˆ°å•é¡Œï¼Œè«‹æª¢æŸ¥ï¼š
1. ç›¸é—œå¥—ä»¶æ˜¯å¦æ­£ç¢ºå®‰è£ (cv2, ultralytics, numpy)
2. æ¨¡å‹æª”æ¡ˆæ˜¯å¦å­˜åœ¨ä¸”æ­£ç¢º
3. FFmpeg æ˜¯å¦å¯ç”¨
4. å½±ç‰‡æª”æ¡ˆæ ¼å¼æ˜¯å¦å—æ”¯æ´

å»ºè­°å…ˆä½¿ç”¨ GUI ç‰ˆæœ¬é€²è¡Œæ¸¬è©¦ï¼Œå› ç‚ºå®ƒæä¾›æ›´å¤šçš„è¦–è¦ºåŒ–å›é¥‹å’Œé™¤éŒ¯è³‡è¨Šã€‚