# 參數調整指南 - 如何優化影片分割效果

## 🎯 偵測信心度 (Confidence Threshold) 調整指南

### 問題診斷與解決方案

#### 🔴 問題：偵測到太多假球 (誤判)
**症狀：**
- 分割出很多片段，但有些沒有球
- 把背景物體誤認為球
- 球拍、線條被誤判為球

**解決方案：**
```
調高信心度閾值：0.5 → 0.7 或 0.8
```

**原理：** 提高標準，只保留模型最確定的偵測結果

#### 🟡 問題：漏掉真實的球 (漏判)
**症狀：**
- 明明有球進入但沒有被分割
- 分割片段太少
- 球很清楚但沒被偵測到

**解決方案：**
```
調低信心度閾值：0.5 → 0.3 或 0.4
```

**原理：** 降低標準，捕捉更多可能的球

#### ✅ 理想狀態
**症狀：**
- 每次真實的球進入都被正確偵測
- 很少有誤判的情況
- 分割片段數量合理

**維持設定：**
```
保持當前信心度：0.5 左右
```

---

## ⏰ 預覽開始時間 (Preview Start Time) 調整指南

### 不同運動的建議設定

#### 🎾 網球 (推薦: -0.5 到 -1.0 秒)
```python
self.preview_start_time = -0.5  # 標準設定
self.preview_start_time = -1.0  # 看更多準備動作
```
**原因：** 需要看到發球或回球前的準備姿勢

#### 🏓 桌球 (推薦: -0.3 到 -0.5 秒)
```python
self.preview_start_time = -0.3  # 動作較快
```
**原因：** 桌球動作較快，不需要太長的準備時間

#### 🏸 羽毛球 (推薦: -0.7 到 -1.2 秒)
```python
self.preview_start_time = -1.0  # 需要更多準備時間
```
**原因：** 羽毛球有較多準備動作和步法

### 實際應用範例
```
球進入時間: 10.0s
預覽設定: -0.5s
實際開始: 9.5s  ← 可以看到球進入前0.5秒的動作

球進入時間: 15.0s  
預覽設定: -1.0s
實際開始: 14.0s  ← 可以看到球進入前1.0秒的動作
```

---

## 📏 最小間隔 (Minimum Interval) 調整指南

### 運動節奏分析

#### 快節奏運動 (桌球、網球單打)
```python
self.min_interval = 1.5  # 減少間隔
```
**原因：** 球的來回較快，需要捕捉更密集的動作

#### 中等節奏運動 (網球雙打、羽毛球)
```python
self.min_interval = 2.0  # 標準設定
```
**原因：** 平衡的節奏，適合大多數情況

#### 慢節奏運動 (訓練、教學影片)
```python
self.min_interval = 3.0  # 增加間隔
```
**原因：** 動作之間有較多解說或準備時間

### 問題診斷
```
如果同一個球被重複偵測多次 → 增加最小間隔
如果相鄰的球被漏掉 → 減少最小間隔
```

---

## 🔄 動態模式 vs 固定模式選擇

### 固定長度模式適用場景
```python
self.dynamic_mode = False
self.segment_duration = 4.0  # 每個片段4秒
```

**適合：**
- 統一分析需求
- 機器學習訓練資料
- 統計分析用途
- 檔案大小需要一致

**範例應用：**
- 動作分析研究
- AI模型訓練
- 批次自動化處理

### 動態長度模式適用場景
```python
self.dynamic_mode = True
self.end_padding = 1.0  # 最後片段額外1秒
```

**適合：**
- 完整動作序列
- 教學分析
- 比賽片段回放
- 保持動作完整性

**範例應用：**
- 教練教學用
- 技術動作分析
- 精彩片段剪輯

---

## 🛠️ 實戰調整策略

### 第一次使用建議設定
```python
confidence_threshold = 0.5      # 平衡點
min_interval = 2.0             # 標準間隔  
preview_start_time = -0.5      # 看到準備動作
dynamic_mode = False           # 先用固定模式測試
segment_duration = 4.0         # 4秒片段
```

### 逐步調整流程

#### 步驟1：測試基本偵測
1. 用預設參數分析一小段影片
2. 檢查「預覽結果」圖表
3. 看信心度曲線是否合理

#### 步驟2：調整偵測精度
```python
# 如果誤判太多
confidence_threshold = 0.7

# 如果漏判太多  
confidence_threshold = 0.3
```

#### 步驟3：調整時間參數
```python
# 如果想看更多準備動作
preview_start_time = -1.0

# 如果球被重複偵測
min_interval = 3.0
```

#### 步驟4：選擇分割模式
```python
# 需要完整動作序列
dynamic_mode = True

# 需要統一長度
dynamic_mode = False
```

---

## 📊 效果評估方法

### 1. 使用預覽功能
```
點擊「預覽結果」→ 查看三個圖表：
1. 信心度時間序列 → 檢查偵測品質
2. 偵測狀態圖 → 確認進入點位置
3. 球的軌跡圖 → 驗證移動邏輯
```

### 2. 檢查分割結果
```
執行分割後檢查：
- 片段數量是否合理？
- 每個片段是否包含球進入？
- 時間長度是否適當？
```

### 3. 調整優化循環
```
分析 → 調整參數 → 重新分析 → 檢查結果 → 繼續調整
```

---

## 🎯 常見場景的最佳設定

### 網球教學影片
```python
confidence_threshold = 0.6
min_interval = 2.5
preview_start_time = -1.0
dynamic_mode = True
end_padding = 1.5
```

### 比賽錄影分析
```python  
confidence_threshold = 0.5
min_interval = 1.8
preview_start_time = -0.5
dynamic_mode = True
end_padding = 1.0
```

### 練習影片分割
```python
confidence_threshold = 0.4
min_interval = 2.0  
preview_start_time = -0.8
dynamic_mode = False
segment_duration = 5.0
```

### 自動化批次處理
```python
confidence_threshold = 0.6
min_interval = 2.5
preview_start_time = -0.5
dynamic_mode = False
segment_duration = 4.0
```

記住：**沒有一套參數適用所有情況，需要根據具體的影片內容和分析需求來調整！**