# çƒå°é…å°ä¿®å¾©æµç¨‹èªªæ˜

## å•é¡Œèªªæ˜

åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œ`align_ball_segments` å‡½æ•¸æœ‰é‡è¤‡çš„ç¨‹å¼ç¢¼å°è‡´åªè™•ç†ç¬¬ä¸€å€‹çƒå°±æå‰è¿”å›ï¼Œå› æ­¤å³ä½¿æœ‰ 3 å€‹çƒæ®µï¼ˆå´é¢å’Œ45åº¦å„3å€‹ï¼‰ï¼Œä¹Ÿåªæœƒç”¢ç”Ÿ 1 å€‹çƒå°å’Œ 1 å€‹ trajectory è³‡æ–™å¤¾ã€‚

## ä¿®å¾©æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šè‡ªå‹•æƒæä¸¦ä¿®å¾©æ‰€æœ‰ä½¿ç”¨è€…çš„çƒå°é…å°

```bash
python auto_fix_all_ball_pairs.py
```

**é€™å€‹è…³æœ¬æœƒï¼š**
1. æƒææ‰€æœ‰ `trajectory/*__trajectory` è³‡æ–™å¤¾
2. æª¢æŸ¥æ¯å€‹ä½¿ç”¨è€…çš„çƒå°æ•¸é‡æ˜¯å¦æ­£ç¢º
3. å¦‚æœçƒå°æ•¸é‡ < çƒæ®µæ•¸é‡ï¼Œè‡ªå‹•é‡æ–°é…å°
4. æ›´æ–° `*__segmentation_results.json` æª”æ¡ˆ
5. **åˆªé™¤èˆŠçš„ trajectory è³‡æ–™å¤¾**ï¼ˆå› ç‚ºæ˜¯åŸºæ–¼éŒ¯èª¤çš„çƒå°ç”Ÿæˆçš„ï¼‰

**çµæœç¯„ä¾‹ï¼š**
```
âœ… å·²ä¿®å¾©: 8 å€‹ä½¿ç”¨è€…
   - TIM1 (0 â†’ 2 çƒå°)
   - TIM2 (0 â†’ 1 çƒå°)
   - TIM50 (1 â†’ 3 çƒå°)
   - tim58 (1 â†’ 3 çƒå°)
   - tim78 (1 â†’ 3 çƒå°)
   - tim80 (1 â†’ 3 çƒå°)
   - tim81 (1 â†’ 3 çƒå°)
   - tim89 (1 â†’ 3 çƒå°)
   - tim90 (1 â†’ 3 çƒå°)
```

### æ­¥é©Ÿ 2ï¼šé‡æ–°è™•ç†æ‰€æœ‰çƒçš„è»Œè·¡

çƒå°ä¿®å¾©å¾Œï¼Œéœ€è¦é‡æ–°ç”Ÿæˆ trajectory è³‡æ–™å¤¾ã€‚

**æ–¹æ³• Aï¼šä½¿ç”¨é€šç”¨è…³æœ¬ï¼ˆæ¨è–¦ï¼‰**
```bash
# èªæ³•
python reprocess_user.py <ä½¿ç”¨è€…åç¨±>

# ç¯„ä¾‹
python reprocess_user.py tim90
python reprocess_user.py TIM82
```

**æ–¹æ³• Bï¼šæ‰¹æ¬¡è™•ç†å¤šå€‹ä½¿ç”¨è€…**
```bash
# å°æ–¼æ­¥é©Ÿ1ä¸­ä¿®å¾©çš„ä½¿ç”¨è€…ï¼Œé€ä¸€è™•ç†
python reprocess_user.py TIM1
python reprocess_user.py TIM2
python reprocess_user.py TIM50
python reprocess_user.py tim58
python reprocess_user.py tim78
python reprocess_user.py tim80
python reprocess_user.py tim81
python reprocess_user.py tim89
python reprocess_user.py tim90
```

**é€™å€‹è…³æœ¬æœƒï¼š**
1. è®€å–æ›´æ–°å¾Œçš„çƒå°æ•¸æ“š
2. ç‚ºæ¯ä¸€å°çƒå»ºç«‹ trajectory_N è³‡æ–™å¤¾
3. åŸ·è¡Œå®Œæ•´çš„è»Œè·¡åˆ†æï¼ˆ2Dã€3Dã€å¹³æ»‘ã€KNNã€GPTï¼‰
4. ç”Ÿæˆæ‰€æœ‰ JSON å’Œå½±ç‰‡æª”æ¡ˆ

### æ­¥é©Ÿ 3ï¼šé©—è­‰çµæœ

ä½¿ç”¨æª¢æŸ¥è…³æœ¬ç¢ºèªä¿®å¾©æˆåŠŸï¼š

```bash
python check_tim82.py <ä½¿ç”¨è€…åç¨±>

# ç¯„ä¾‹
python check_tim82.py tim90
```

**é æœŸè¼¸å‡ºï¼š**
```
ğŸ“Š tim90 åˆ†å‰²çµæœåˆ†æ
============================================================

å´é¢ç‰‡æ®µ: 3 å€‹
45åº¦ç‰‡æ®µ: 3 å€‹

çƒå°æ•¸é‡: 3 å°
  çƒ1: å´é¢=0.23s, 45åº¦=0.70s, å·®ç•°=0.47s, ç‹€æ…‹=paired
  çƒ2: å´é¢=2.03s, 45åº¦=2.80s, å·®ç•°=0.77s, ç‹€æ…‹=paired
  çƒ3: å´é¢=3.83s, 45åº¦=4.90s, å·®ç•°=1.07s, ç‹€æ…‹=paired

ğŸ“ æª¢æŸ¥çƒè³‡æ–™å¤¾:
  æ‰¾åˆ° 3 å€‹çƒè³‡æ–™å¤¾:
    - trajectory_1 (12 å€‹æª”æ¡ˆ) âœ…
    - trajectory_2 (12 å€‹æª”æ¡ˆ) âœ…
    - trajectory_3 (12 å€‹æª”æ¡ˆ) âœ…
```

## ç‚ºä»€éº¼ä¿®å¾©å¾Œè³‡æ–™å¤¾æœƒæ¶ˆå¤±ï¼Ÿ

é€™æ˜¯**æ­£å¸¸ä¸”å¿…è¦çš„**ï¼

1. **èˆŠçš„ trajectory è³‡æ–™å¤¾æ˜¯åŸºæ–¼éŒ¯èª¤çš„çƒå°ç”Ÿæˆçš„**
   - ä¾‹å¦‚ï¼šåªæœ‰ 1 å€‹çƒå°ï¼Œä½†å¯¦éš›æ‡‰è©²æœ‰ 3 å€‹
   - é€™äº›è³‡æ–™å¤¾ä¸­çš„æ•¸æ“šæ˜¯ä¸å®Œæ•´çš„

2. **ä¿®å¾©æµç¨‹æœƒåˆªé™¤èˆŠè³‡æ–™å¤¾**
   - `auto_fix_all_ball_pairs.py` æœƒåˆªé™¤èˆŠçš„ trajectory_N è³‡æ–™å¤¾
   - ç¢ºä¿ä¸æœƒæœ‰æ··æ·†ï¼ˆæ–°èˆŠè³‡æ–™æ··åœ¨ä¸€èµ·ï¼‰

3. **é‡æ–°è™•ç†æœƒç”Ÿæˆæ–°çš„å®Œæ•´è³‡æ–™å¤¾**
   - `reprocess_user.py` æœƒåŸºæ–¼æ­£ç¢ºçš„çƒå°é‡æ–°ç”Ÿæˆæ‰€æœ‰è³‡æ–™å¤¾
   - æ¯å€‹è³‡æ–™å¤¾éƒ½åŒ…å«å®Œæ•´çš„åˆ†æçµæœ

## æª”æ¡ˆçµæ§‹

ä¿®å¾©å®Œæˆå¾Œï¼Œæ¯å€‹ä½¿ç”¨è€…çš„è³‡æ–™å¤¾çµæ§‹æ‡‰è©²æ˜¯ï¼š

```
trajectory/tim90__trajectory/
â”œâ”€â”€ segments/                           # åˆ†æ®µå½±ç‰‡
â”‚   â”œâ”€â”€ tim90__1_side_segment.mp4
â”‚   â”œâ”€â”€ tim90__1_45_segment.mp4
â”‚   â”œâ”€â”€ tim90__2_side_segment.mp4
â”‚   â”œâ”€â”€ tim90__2_45_segment.mp4
â”‚   â”œâ”€â”€ tim90__3_side_segment.mp4
â”‚   â””â”€â”€ tim90__3_45_segment.mp4
â”œâ”€â”€ trajectory_1/                       # ç¬¬1çƒçš„å®Œæ•´åˆ†æ
â”‚   â”œâ”€â”€ tim90__1_side_segment(2D_trajectory).json
â”‚   â”œâ”€â”€ tim90__1_side_segment(2D_trajectory_smoothed).json
â”‚   â”œâ”€â”€ tim90__1_45_segment(2D_trajectory).json
â”‚   â”œâ”€â”€ tim90__1_45_segment(2D_trajectory_smoothed).json
â”‚   â”œâ”€â”€ tim90__1_segment(3D_trajectory).json
â”‚   â”œâ”€â”€ tim90__1_segment(3D_trajectory_smoothed).json
â”‚   â”œâ”€â”€ tim90__1_segment(3D_trajectory_smoothed)_only_swing.json
â”‚   â”œâ”€â”€ tim90__1_segment_knn_feedback.txt
â”‚   â”œâ”€â”€ tim90__1_segment_gpt_feedback.json
â”‚   â”œâ”€â”€ tim90__1_side_segment_processed.mp4
â”‚   â”œâ”€â”€ tim90__1_45_segment_processed.mp4
â”‚   â””â”€â”€ tim90__1_full_video.mp4
â”œâ”€â”€ trajectory_2/                       # ç¬¬2çƒçš„å®Œæ•´åˆ†æ
â”‚   â””â”€â”€ ... (ç›¸åŒçš„æª”æ¡ˆçµæ§‹)
â”œâ”€â”€ trajectory_3/                       # ç¬¬3çƒçš„å®Œæ•´åˆ†æ
â”‚   â””â”€â”€ ... (ç›¸åŒçš„æª”æ¡ˆçµæ§‹)
â”œâ”€â”€ tim90__segmentation_results.json   # åˆ†æ®µå’Œçƒå°é…å°çµæœ
â”œâ”€â”€ tim90__processing_summary.json     # è™•ç†æ‘˜è¦
â””â”€â”€ user_info.json                      # ä½¿ç”¨è€…è³‡è¨Š
```

## å¸¸ç”¨è…³æœ¬ç¸½è¦½

| è…³æœ¬ | ç”¨é€” | ä½¿ç”¨æ™‚æ©Ÿ |
|------|------|----------|
| `auto_fix_all_ball_pairs.py` | è‡ªå‹•æƒæä¸¦ä¿®å¾©æ‰€æœ‰ä½¿ç”¨è€…çš„çƒå°é…å° | ç™¼ç¾çƒå°é…å°æœ‰å•é¡Œæ™‚ |
| `reprocess_user.py <ä½¿ç”¨è€…>` | é‡æ–°è™•ç†å–®ä¸€ä½¿ç”¨è€…çš„æ‰€æœ‰çƒ | ä¿®å¾©çƒå°å¾Œï¼Œéœ€è¦é‡æ–°ç”Ÿæˆ trajectory è³‡æ–™å¤¾ |
| `check_tim82.py <ä½¿ç”¨è€…>` | æª¢æŸ¥ä½¿ç”¨è€…çš„çƒå°å’Œè³‡æ–™å¤¾ç‹€æ…‹ | é©—è­‰ä¿®å¾©çµæœ |
| `quick_test_ball_pairing.py` | æ¸¬è©¦çƒå°é…å°å‡½æ•¸æ˜¯å¦æ­£å¸¸ | é©—è­‰ç¨‹å¼ç¢¼ä¿®å¾© |

## æ³¨æ„äº‹é …

1. **Python æ¨¡çµ„å¿«å–å•é¡Œ**
   - ä¿®æ”¹ç¨‹å¼ç¢¼å¾Œï¼Œå»ºè­°**é‡æ–°é–‹å•Ÿçµ‚ç«¯æ©Ÿ**å†åŸ·è¡Œ
   - æˆ–åœ¨åŸ·è¡Œå‰æ¸…é™¤å¿«å–ï¼š`Get-ChildItem -Recurse -Filter "__pycache__" | Remove-Item -Recurse -Force`

2. **é‡æ–°è™•ç†éœ€è¦æ™‚é–“**
   - æ¯å€‹çƒå¤§ç´„éœ€è¦ 1-2 åˆ†é˜ï¼ˆåŒ…å« 2D/3D åˆ†æã€å½±ç‰‡è™•ç†ã€KNNã€GPTï¼‰
   - 3 å€‹çƒå¤§ç´„éœ€è¦ 3-6 åˆ†é˜

3. **GPT API é…é¡**
   - å¦‚æœ GPT API é…é¡ä¸è¶³ï¼Œæœƒè‡ªå‹•ä½¿ç”¨ KNN çµæœä½œç‚ºå‚™æ¡ˆ
   - ä¸æœƒä¸­æ–·è™•ç†æµç¨‹

## å•é¡Œæ’æŸ¥

**Q: ç‚ºä»€éº¼ä¿®å¾©å¾Œè³‡æ–™å¤¾ä¸è¦‹äº†ï¼Ÿ**
A: é€™æ˜¯æ­£å¸¸çš„ï¼èˆŠè³‡æ–™å¤¾æœƒè¢«åˆªé™¤ï¼Œéœ€è¦åŸ·è¡Œ `reprocess_user.py` é‡æ–°ç”Ÿæˆã€‚

**Q: é‡æ–°è™•ç†è¦å¤šä¹…ï¼Ÿ**
A: æ¯å€‹çƒç´„ 1-2 åˆ†é˜ï¼Œ3 å€‹çƒç´„ 3-6 åˆ†é˜ã€‚

**Q: å¦‚ä½•ç¢ºèªä¿®å¾©æˆåŠŸï¼Ÿ**
A: åŸ·è¡Œ `python check_tim82.py <ä½¿ç”¨è€…>` æª¢æŸ¥çƒå°æ•¸é‡å’Œè³‡æ–™å¤¾ã€‚

**Q: æ–°è™•ç†çš„ä½¿ç”¨è€…æœƒæ­£å¸¸å—ï¼Ÿ**
A: æ˜¯çš„ï¼ç¨‹å¼ç¢¼å·²ä¿®å¾©ï¼Œæ–°è™•ç†çš„ä½¿ç”¨è€…æœƒè‡ªå‹•ç”¢ç”Ÿæ­£ç¢ºæ•¸é‡çš„çƒå°å’Œè³‡æ–™å¤¾ã€‚å»ºè­°æ¯æ¬¡ä¿®æ”¹ç¨‹å¼ç¢¼å¾Œé‡æ–°é–‹å•Ÿçµ‚ç«¯æ©Ÿã€‚
